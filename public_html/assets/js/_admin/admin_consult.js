var teacher_change_image=0;var consult_id=0;var code="";var image="";var drEvent = $('.dropify').dropify({    messages: {        'default': 'یک فایل را در اینجا بکشید و رها کنید یا کلیک کنید',        'replace': 'برای جایگزینی یک فایل را در اینجا بکشید و رها کنید یا کلیک کنید',        'remove': 'حذف',        'error': 'خطا، چیزی اشتباه اضافه شده است.'    },    error: {        'fileSize': 'اندازه فایل زیاد می باشد (تصویر 5 مگابات و ویدیو حداکثر 100 مگابایت می باشد).',        'minWidth': 'The image width is too small min).',        'maxWidth': 'The image width is too big px max).',        'minHeight': 'The image height is too small px min).',        'maxHeight': 'The image height is too big px max).',        'imageFormat': 'فرمت عکس نامعتبر می باشد. (jpg-png-jpeg-gif)'    }});drEvent.on('dropify.errors', function (event, element) {    ShowMessage('خطا در فایل انتخاب شده !', 'error')});drEvent.on('dropify.error.imageFormat', function (event, element) {    ShowMessage('فرمت فایل معتبر نمی باشد. فرمت های قابل قبول تصاویر(jpg-png-jpeg-gif) و فرمت های قابل قبول ویدیو(mp4-mp3-3gp-mpg-mpeg)', 'error');});function loadAllConsulting() {    consulting_datatable.DataTable({        // processing: true,        // serverSide: true,        order: [[7, 'asc']],        paging: true,        searching: true,        pageLength: 10,        ordering: true,        Destroy: true,        ajax: {            url: "consult/all_consultTimes",            type: "POST",            data: function (d) {            },            headers: {                'X-CSRF-TOKEN': $("#csrf-token").attr('content')            },            // beforeSend: function(){            //     ShowWaiting("بارگزاری نظرات ایده");            // },            // dataSrc: function ( ) {            //     CloseWaiting();            // },        },        columns: [            {                mRender: function (data, type, row, meta) {                    return meta.row + meta.settings._iDisplayStart + 1;                }            },            {                mRender: function (data, type, row) {                    return row.user_name;                }            },            {                mRender: function (data, type, row) {                    return row.regist_date;                }            },            {                mRender: function (data, type, row) {                    return row.consult_date +" ساعت " +row.consult_time;                }            },            {                mRender: function (data, type, row) {                    return row.consult_type;                }            },            {                mRender: function (data, type, row) {                    var  abstract_comment=makeAbstract(row.memo,30);                    var tag= "<p class='font-13' title='"+row.memo+"' style='cursor: help'>"+abstract_comment+"</p>";                    return tag;                }            },            {                mRender: function (data, type, row) {                    return row.status;                }            },            {                mRender: function (data, type, row) {                    var title=row.user_name;                    if(title!= null)                        title=title.replace(' ','_');                    var facts=`<a href="consult/consulting/`+row.id+`/`+title+`" title="مشاهده جزئیات" class="btn btn-success  btn-sm text-white"> <i class="fa fa-eye"></i> </a>&nbsp;`;                    return facts;                }            },        ]    });}function view_message(id_mess) {    let targerData = new FormData();    targerData.append('id_mess', id_mess);    targerData.append('id_course', $("#id_course").val());    $.ajax({        url: "_manager/course/get_message",        type: 'POST',        cache: false,        data: targerData,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("مشاهده پیام");        },        success: function (result) {            if (!result.error) {                var mess_data=result.data;                $("#mess_message").val(mess_data.message);                $("#mess_id_user").val(mess_data.id_user);                $("#mess_subject").text(mess_data.subject);                $("#reply_mess_message").val(mess_data.replay_message);                $("#mess_id").val(id_mess);            }            else {                ShowMessage(result.message, result.type);            }        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });    $('#message_modal').modal('toggle');}function loadConsultPayments() {    table_payments.DataTable({        // processing: true,        // serverSide: true,        // order: [[1, 'asc']],        paging: true,        searching: true,        pageLength: 10,        ordering: true,        Destroy: true,        ajax: "consult/all_consult_payments",        columns: [            {                mRender: function (data, type, row, meta) {                    return meta.row + meta.settings._iDisplayStart + 1;                }            },            {                mRender: function (data, type, row) {                    return row.regist_date;                }            },            {                mRender: function (data, type, row) {                    var vall="";                    return row.product_course_title;                }            },            {                mRender: function (data, type, row) {                    // if(row.payment_price>0) {                    //     var total=0;                    //     total = parseFloat(total) + parseFloat(row.payment_price);                        // $("#total").text("مجموع درآمد: " + total +" تومان ");                    // }                    return row.payment_price;                }            },            {                mRender: function (data, type, row) {                    return row.refID;                }            },            // {            //     mRender: function (data, type, row) {            //         var facts=`<button type="button" onclick="viewComment(`+row.id+`)" title="نمایش" class="btn btn-success  btn-sm text-white"> <i class="fa fa-eye"></i></button>&nbsp;`;            //         return facts;            //     }            // },        ]    });}function loadConsultCommments() {    comment_table.DataTable({        // processing: true,        // serverSide: true,        order: [[0, 'desc']],        paging: true,        searching: true,        pageLength: 10,        ordering: true,        Destroy: true,        ajax: "consult/all_comments",        columns: [            {                mRender: function (data, type, row, meta) {                    return meta.row + meta.settings._iDisplayStart + 1;                }            },            {                mRender: function (data, type, row) {                    var username=row.fullname;                    username=username.replace(' ','_');                    var user=`<a href="profile/`+row.id_user+`/`+username+`" title="مشخصات کاربر ارسال کننده" target="_blank" class="btn btn-info  btn-sm text-white"> <i class="fa fa-user"></i> `+row.fullname+` </a>&nbsp;`;                    return user;                }            },            {                mRender: function (data, type, row) {                    if(row.read_status==1)                        return row.regist_date;                    else                        return "<strong>"+row.regist_date+"</strong>"                }            },            {                mRender: function (data, type, row) {                    if(row.read_status==1)                        return row.score;                    else                        return "<strong>"+row.score+"</strong>"                }            },            {                mRender: function (data, type, row) {                    var  abstract_comment=makeAbstract(row.comment,30);                    var tag= "<p class='font-13' title='"+row.comment+"' style='cursor: help'>"+abstract_comment+"</p>";                    if(row.read_status==1)                        return tag;                    else                        return "<strong>"+tag+"</strong>"                }            },            {                mRender: function (data, type, row) {                    var facts="";                    facts=facts+`<button type="button" onclick="viewComment(`+row.id+`)" title="نمایش" class="btn btn-success  btn-sm text-white"> <i class="fa fa-eye"></i></button>&nbsp;`;                    // facts=facts+`<button type="button" onclick="deleteComment(`+row.id+`)" title="حذف" class="btn btn-danger  btn-sm text-white"> <i class="fa fa-trash"></i></button>`;                    return facts;                }            },        ]    });}$("#btn_update_personal_info").on("click",function (event) {    var consult_cloud_url = $("#consult_cloud_url").val();    var consult_category = $("#consult_category").val();    var consult_name = $("#consult_name").val();    var consult_education = $("#consult_education").val();    var consult_univercity = $("#consult_univercity").val();    var state = $("#state").val();    var city = $("#city").val();    var consult_address_work = $("#consult_address_work").val();    var consult_address_home = $("#consult_address_home").val();    var consult_married = $("#consult_married").val();    var consult_job = $("#consult_job").val();    var consult_gender = $("#consult_gender").val();    var consult_birthdate_place = $("#consult_birthdate_place").val();    var consult_birthdate = $("#consult_birthdate").val();    var consult_nationalid = $("#consult_nationalid").val();    var consult_image=$('#consult_image')[0].files[0];    let formDataa = new FormData();    formDataa.append('consult_image', consult_image);    formDataa.append('consult_cloud_url', consult_cloud_url);    formDataa.append('consult_category', consult_category);    formDataa.append('consult_name', consult_name);    formDataa.append('consult_education', consult_education);    formDataa.append('consult_univercity', consult_univercity);    formDataa.append('state', state);    formDataa.append('city', city);    formDataa.append('consult_address_work', consult_address_work);    formDataa.append('consult_address_home', consult_address_home);    formDataa.append('consult_married', consult_married);    formDataa.append('consult_job', consult_job);    formDataa.append('consult_gender', consult_gender);    formDataa.append('consult_birthdate_place', consult_birthdate_place);    formDataa.append('consult_birthdate', consult_birthdate);    formDataa.append('consult_nationalid', consult_nationalid);    formDataa.append('consult_id', $("#consult_id").val());    formDataa.append('consult_change_image', consult_change_image);    $.ajax({        url: "_manager/consult/edit_consult_info",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثبت تغییرات مشخصات مشاور");        },        success: function (result) {            if (!result.error) {                $("#menu_tab_skill").click();                $(".dropify-clear").trigger("click");                $('.ckeditor').val("");            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$("#btn_update_skill_info").on("click",function (event) {    var consult_education = $("#consult_education").val();    var consult_univercity = $("#consult_univercity").val();    var abstractAbout = $("#abstractAbout").val();    var skills = CKEDITOR.instances['skills'].getData();    var learn_history = CKEDITOR.instances['learn_history'].getData();    var about = CKEDITOR.instances['about'].getData();    let formDataa = new FormData();    formDataa.append('abstractAbout', abstractAbout);    formDataa.append('about', about);    formDataa.append('learn_history', learn_history);    formDataa.append('skills', skills);    formDataa.append('consult_education', consult_education);    formDataa.append('consult_univercity', consult_univercity);    formDataa.append('consult_id', $("#consult_id").val());    $.ajax({        url: "_manager/consult/edit_consult_skill",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثبت تغییرات مشخصات مهارتی مشاور");        },        success: function (result) {            if (!result.error) {                $("#menu_tab_contact").click();                $(".dropify-clear").trigger("click");                $('.ckeditor').val("");            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$("#btn_update_contact_info").on("click",function (event) {    var consult_mobile = $("#mobile").val();    var consult_mobile2 = $("#mobile2").val();    var consult_tel = $("#tel").val();    var consult_tel_work = $("#tel_work").val();    var consult_email = $("#email").val();    var consult_website = $("#website").val();    var consult_soroush = $("#soroush").val();    var consult_eita = $("#eita").val();    var consult_telegram = $("#telegram").val();    var consult_instgram = $("#instagram").val();    var consult_linkdin = $("#linkdin").val();    var consult_whatapp = $("#whatsapp").val();    var consult_aparat = $("#aparat").val();    let formDataa = new FormData();    formDataa.append('consult_mobile', consult_mobile);    formDataa.append('consult_mobile2', consult_mobile2);    formDataa.append('consult_tel', consult_tel);    formDataa.append('consult_tel_work', consult_tel_work);    formDataa.append('consult_email', consult_email);    formDataa.append('consult_website', consult_website);    formDataa.append('consult_soroush', consult_soroush);    formDataa.append('consult_eita', consult_eita);    formDataa.append('consult_telegram', consult_telegram);    formDataa.append('consult_instgram', consult_instgram);    formDataa.append('consult_linkdin', consult_linkdin);    formDataa.append('consult_whatapp', consult_whatapp);    formDataa.append('consult_aparat', consult_aparat);    formDataa.append('consult_id', $("#consult_id").val());    $.ajax({        url: "_manager/consult/edit_consult_contact",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثبت تغییرات مشخصات تماس مشاور");        },        success: function (result) {            if (!result.error) {                $("#menu_tab_bank").click();                $(".dropify-clear").trigger("click");                $('.content').val("");            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$("#btn_update_bank_info").on("click",function (event) {    var teacher_accountnumber = $("#account_no").val();    var teacher_cardnumber = $("#cardnumber").val();    var teacher_shabanumber = $("#shabanumber").val();    let formDataa = new FormData();    formDataa.append('consult_accountnumber', teacher_accountnumber);    formDataa.append('consult_cardnumber', teacher_cardnumber);    formDataa.append('consult_shabanumber', teacher_shabanumber);    formDataa.append('consult_id', $("#consult_id").val());    $.ajax({        url: "_manager/consult/edit_consult_bank",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثبت تغییرات مشخصات بانکی مشاور");        },        success: function (result) {            if (!result.error) {                $(".dropify-clear").trigger("click");                $('.content').val("");            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$("#btn_add_new_education").on("click",function(){    var grade_new=$("#grade_new").val();    var univercity_new=$("#univercity_new").val();    let formDataa = new FormData();    formDataa.append('grade_new', grade_new);    formDataa.append('univercity_new', univercity_new);    formDataa.append('consult_id', $("#consult_id").val());    $.ajax({        url: "_manager/consult/add_education",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثبت اطلاعات مهارتی");        },        success: function (result) {            if (!result.error) {                $("#grade_new").val("");                $("#univercity_new").val("");                var tr=`<tr id="tr_edu_"`+result.data+`><td>`+grade_new+`</td><td>`+univercity_new+`</td><td><a class="btn  btn-danger btn-app" onclick="deleteEducation(`+result.data+`)" title="حذف" style="height: auto;!important; padding: 5px;!important;"><i class="fa fa-trash"></i> حذف</a></td></tr>`;                $("#table_education").append(tr);                $('#eduction_model').modal('toggle');            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$('#state').on('change', function (e) {    e.preventDefault();    var selectData = $(this).val();    let formData= new FormData();    formData.append('state',selectData);    $.ajax({        url: "getCity",        type: 'POST',        cache: false,        data: formData,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            // ShowWaiting("در حال ذخیره تغییرات");        },        success: function (result) {            if (!result.error) {                $('#city').html(result.data);            }        },        complete: function () {            // CloseWaiting();        },        error: function () {        }    });});$("#btn_set_consulting_time").on("click",function(){    let formDataa = new FormData();    formDataa.append('consult_date',$("#consult_date").val());    formDataa.append('consult_time',$("#consult_time").val());    formDataa.append('id_consulting', $("#id_consulting").val());    $.ajax({        url: "_manager/consult/set_consult_time",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثبت تاریخخ مشاوره");        },        success: function (result) {            if (!result.error) {            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$("#btn_complete_consult").on("click",function(){    let formDataa = new FormData();    formDataa.append('user_score',$("#user_score").val());    formDataa.append('user_comment',$("#user_comment").val());    formDataa.append('consult_minutes',$("#consult_minutes").val());    formDataa.append('id_consulting', $("#id_consulting").val());    $.ajax({        url: "_manager/consult/complete_consult",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("تکمیل و پایان مشاوره");        },        success: function (result) {            if (!result.error) {            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});$("#btn_update_setting_password").on("click",function (event) {    var nowpass=$("#nowpass").val();    var newpass=$("#newpass").val();    var renewpass=$("#renewpass").val();    if(newpass==renewpass){        if(newpass.length < 8){            ShowMessage("تعداد کاراکترهای کلمه عبور جدید کم است", "error");        }        else {            let formDataa = new FormData();            formDataa.append('nowpass', nowpass);            formDataa.append('newpass', newpass);            formDataa.append('renewpass', renewpass);            $.ajax({                url: "updateUserPass",                type: 'POST',                cache: false,                data: formDataa,                contentType: false,                processData: false,                headers: {                    'X-CSRF-TOKEN': $("#csrf-token").attr('content')                },                beforeSend: function () {                    ShowWaiting("ثب تغییرات امنیتی");                },                success: function (result) {                    if (!result.error) {                    }                    ShowMessage(result.message, result.type);                },                complete: function () {                    CloseWaiting();                },                error: function () {                    CloseWaiting();                    ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');                }            });        }    }    else        ShowMessage("کلمات عبور جدید یکسان نمی باشد", "error");});$("#btn_update_setting_permission").on("click",function (event) {    var view_phone=0;    var view_email=0;    var view_chat=0;    var view_social=0;    if ($('#view_phone').is(":checked"))        view_phone=1;    if ($('#view_email').is(":checked"))        view_email=1;    if ($('#view_chat').is(":checked"))        view_chat=1;    if ($('#view_social').is(":checked"))        view_social=1;    let formDataa = new FormData();    formDataa.append('view_phone', view_phone);    formDataa.append('view_email', view_email);    formDataa.append('view_chat', view_chat);    formDataa.append('view_social', view_social);    $.ajax({        url: "updateUserPermission",        type: 'POST',        cache: false,        data: formDataa,        contentType: false,        processData: false,        headers: {            'X-CSRF-TOKEN': $("#csrf-token").attr('content')        },        beforeSend: function () {            ShowWaiting("ثب تغییرات پروفایل");        },        success: function (result) {            if (!result.error) {            }            ShowMessage(result.message, result.type);        },        complete: function () {            CloseWaiting();        },        error: function () {            CloseWaiting();            ShowMessage('خطای ناشتاخته', '« صفحه را تجدید (بازنشانی) کرده و مجددا تلاش نمایید. »', 'error');        }    });});